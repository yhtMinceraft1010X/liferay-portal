@component-name = "portal-lima"
definition {

	property portal.acceptance = "true";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Translations Management";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			User.logoutPG();
		}
	}

	@description = "This ensures that the translation in the web content will not be retained after deleting the translation in draft status from the app."
	@priority = "4"
	@refactordone
	test CanDeleteDraftTranslation {
		JSONWebcontent.addWebContent(
			content = "WC WebContent Content",
			description = "Description",
			groupName = "Guest",
			title = "WC WebContent Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.viewBaseFields(
			webContentContent = "WC WebContent Content",
			webContentTitle = "WC WebContent Title");

		Translations.translateFields(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		PortletEntry.saveAsDraft();

		Translations.openTranslationAdmin(siteURLKey = "guest");

		Translations.viewTranslationEntry(
			language = "es-ES",
			status = "Draft",
			title = "Translation of WC WebContent Title to es-ES");

		Translations.deleteTranslationEntry(
			confirmationText = "Are you sure you want to delete this? It will be deleted immediately.",
			translationEntry = "Translation of WC WebContent Title to es-ES");

		Translations.viewEmptyState();

		WebContentNavigator.openToEditWCInSite(
			groupName = "Guest",
			siteURLKey = "guest",
			webContentTitle = "WC WebContent Title");

		Translations.viewUntranslatedStatus(locale = "es-ES");
	}

	@description = "This ensures that The translation in the web content remains after deleting the translation in approved status from the app."
	@priority = "5"
	@refactordone
	test CanDeleteTranslation {
		JSONWebcontent.addWebContent(
			content = "WC WebContent Content",
			description = "Description",
			groupName = "Guest",
			title = "WC WebContent Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.viewBaseFields(
			webContentContent = "WC WebContent Content",
			webContentTitle = "WC WebContent Title");

		Translations.translateFields(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		PortletEntry.publish();

		Translations.openTranslationAdmin(siteURLKey = "guest");

		Translations.viewTranslationEntry(
			language = "es-ES",
			status = "Approved",
			title = "Translation of WC WebContent Title to es-ES");

		Translations.deleteTranslationEntry(
			confirmationText = "Are you sure you want to delete this? It will be deleted immediately.",
			translationEntry = "Translation of WC WebContent Title to es-ES");

		Translations.viewEmptyState();

		WebContentNavigator.openToEditWCInSite(
			groupName = "Guest",
			siteURLKey = "guest",
			version = "1.1",
			webContentTitle = "WC WebContent Title");

		PortletEntry.changeLocale(locale = "es-ES");

		WebContent.viewCP(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");
	}

	@description = "This ensures that the translation can be edited under Translations app."
	@priority = "5"
	@refactordone
	test CanEditTranslation {
		JSONWebcontent.addWebContent(
			content = "WC WebContent Content",
			description = "Description",
			groupName = "Guest",
			title = "WC WebContent Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		AssertElementNotPresent(
			key_text = "Auto Translate",
			locator1 = "Button#ANY");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.viewBaseFields(
			webContentContent = "WC WebContent Content",
			webContentTitle = "WC WebContent Title");

		Translations.translateFields(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		PortletEntry.publish();

		Translations.openTranslationAdmin(siteURLKey = "guest");

		Translations.viewTranslationEntry(
			language = "es-ES",
			status = "Approved",
			title = "Translation of WC WebContent Title to es-ES");

		Translations.editTranslationEntry(translationEntry = "Translation of WC WebContent Title to es-ES");

		Translations.viewTranslationDetails(
			currentTargetLocale = "es-ES",
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		Translations.translateFields(
			webContentContent = "WC WebContent Contenido editar",
			webContentDescription = "WC WebContent Descripción editar",
			webContentTitle = "WC WebContent Título editar");

		PortletEntry.publish();

		Translations.editTranslationEntry(translationEntry = "Translation of WC WebContent Title to es-ES");

		Translations.viewTranslationDetails(
			currentTargetLocale = "es-ES",
			webContentContent = "WC WebContent Contenido editar",
			webContentDescription = "WC WebContent Descripción editar",
			webContentTitle = "WC WebContent Título editar");

		WebContentNavigator.openToEditWCInSite(
			groupName = "Guest",
			siteURLKey = "guest",
			version = "1.1",
			webContentTitle = "WC WebContent Title");

		PortletEntry.changeLocale(locale = "es-ES");

		WebContent.viewCP(
			webContentContent = "WC WebContent Contenido editar",
			webContentDescription = "WC WebContent Descripción editar",
			webContentTitle = "WC WebContent Título editar");
	}

	@description = "This ensures that the translation can be edited to a new language under Translations app."
	@priority = "5"
	@refactordone
	test CanEditTranslationToNewLanguage {
		JSONWebcontent.addWebContent(
			content = "WC WebContent Content",
			description = "Description",
			groupName = "Guest",
			title = "WC WebContent Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.viewBaseFields(
			webContentContent = "WC WebContent Content",
			webContentTitle = "WC WebContent Title");

		Translations.translateFields(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		PortletEntry.publish();

		Translations.openTranslationAdmin(siteURLKey = "guest");

		Translations.viewTranslationEntry(
			language = "es-ES",
			status = "Approved",
			title = "Translation of WC WebContent Title to es-ES");

		Translations.editTranslationEntry(translationEntry = "Translation of WC WebContent Title to es-ES");

		Translations.viewTranslationDetails(
			currentTargetLocale = "es-ES",
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		Translations.changeTargetLocale(
			currentTargetLocale = "es-ES",
			newTargetLocale = "ja-JP");

		Translations.translateFields(
			webContentContent = "wc webcontentコンテンツ",
			webContentDescription = "wc webcontent記述",
			webContentTitle = "wc webcontentタイトル");

		PortletEntry.publish();

		Translations.editTranslationEntry(translationEntry = "Translation of WC WebContent Title to ja-JP");

		Translations.viewTranslationDetails(
			currentTargetLocale = "ja-JP",
			webContentContent = "wc webcontentコンテンツ",
			webContentDescription = "wc webcontent記述",
			webContentTitle = "wc webcontentタイトル");

		WebContentNavigator.openToEditWCInSite(
			groupName = "Guest",
			siteURLKey = "guest",
			version = "1.1",
			webContentTitle = "WC WebContent Title");

		PortletEntry.changeLocale(locale = "es-ES");

		WebContent.viewCP(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		PortletEntry.changeLocale(locale = "ja-JP");

		WebContent.viewCP(
			webContentContent = "wc webcontentコンテンツ",
			webContentDescription = "wc webcontent記述",
			webContentTitle = "wc webcontentタイトル");
	}

	@description = "This test covers LPS-127980. This ensures that the newly added field can be translated after updating the WC structure."
	@priority = "4"
	@refactordone
	test CanTranslateWCAfterEditingStructure {
		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		NavItem.gotoStructures();

		WebContentStructures.addCP(
			structureDescription = "WC Structure Description",
			structureName = "WC Structure Name");

		DataEngine.addField(
			fieldFieldLabel = "Text",
			fieldName = "Text");

		WebContentStructures.saveCP(structureName = "WC Structure Name");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		NavItem.gotoTemplates();

		WebContentTemplates.addCP(
			structureName = "WC Structure Name",
			templateDescription = "WC Template Description",
			templateName = "WC Template Name");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		WebContentNavigator.gotoAddWithStructureCP(structureName = "WC Structure Name");

		WebContent.addWithStructureCP(
			structureName = "WC Structure Name",
			templateName = "WC Template Name",
			webContentText = "WC WebContent Text",
			webContentTitle = "WC WebContent Title");

		PortletEntry.publish();

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.viewBaseFields(
			webContentText = "Text",
			webContentTitle = "WC WebContent Title");

		Translations.translateFields(
			webContentText = "Mensaje de texto",
			webContentTitle = "WC WebContent Título");

		PortletEntry.publish();

		NavItem.gotoStructures();

		WebContentNavigator.gotoEditStructure(structureName = "WC Structure Name");

		DataEngine.addField(
			fieldFieldLabel = "Numeric",
			fieldName = "Numeric");

		WebContentStructures.saveCP(structureName = "WC Structure Name");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.viewBaseFields(
			webContentNumeric = "",
			webContentNumericFieldLabel = "Numeric");

		Translations.translateFields(webContentNumber = "200");

		PortletEntry.publish();

		Translations.openTranslationAdmin(siteURLKey = "guest");

		Translations.editTranslationEntry(translationEntry = "Translation of WC WebContent Title to es-ES");

		Translations.viewTranslationDetails(
			currentTargetLocale = "es-ES",
			webContentNumber = "200",
			webContentText = "Mensaje de texto",
			webContentTitle = "WC WebContent Título");
	}

	@description = "This ensures that the modification date of a translation can be displayed correctly after editing."
	@priority = "3"
	@refactordone
	test CanViewEntryModifiedDate {
		JSONWebcontent.addWebContent(
			content = "WC WebContent Content",
			groupName = "Guest",
			title = "WC WebContent Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.translateFields(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descriptionscripción",
			webContentTitle = "WC WebContent Título");

		Button.clickPublish();

		ProductMenu.gotoPortlet(
			category = "Content & Data",
			portlet = "Translation Processes");

		Translations.viewTranslationEntry(
			language = "es-ES",
			modifiedDate = "Seconds Ago",
			status = "Approved",
			title = "Translation of WC WebContent Title to es-ES");

		Pause(locator1 = "60000");

		Refresh();

		Translations.viewTranslationEntry(
			language = "es-ES",
			modifiedDate = "Minute Ago",
			status = "Approved",
			title = "Translation of WC WebContent Title to es-ES");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.translateFields(webContentTitle = "WC WebContent Título editar");

		Button.clickPublish();

		ProductMenu.gotoPortlet(
			category = "Content & Data",
			portlet = "Translation Processes");

		Translations.viewTranslationEntry(
			language = "es-ES",
			modifiedDate = "Seconds Ago",
			status = "Approved",
			title = "Translation of WC WebContent Title to es-ES");
	}

	@description = "This test covers LPS-142411. It ensures that a translation entry is not shown after deleting translated content page with new experience."
	@priority = "4"
	test EntryIsNotShownAfterDeletingTranslatedPage {
		JSONGroup.addGroup(groupName = "Test Site Name");

		JSONLayout.addPublicLayout(
			groupName = "Test Site Name",
			layoutName = "Test Content Page Name",
			type = "content");

		JSONSegmentsentry.addSegment(
			fieldName = "Email Address",
			groupName = "Test Site Name",
			operator = "contains",
			segmentName = "Segment Email Address",
			text = "test@liferay.com");

		ContentPagesNavigator.openEditContentPage(
			pageName = "Test Content Page Name",
			siteName = "Test Site Name");

		PageEditor.addExperience(
			experienceName = "Segment Email Experience",
			segmentName = "Segment Email Address");

		PageEditor.addFragment(
			collectionName = "Basic Components",
			fragmentName = "Heading");

		PageEditor.clickPublish();

		PagesAdmin.openPagesAdmin(siteURLKey = "test-site-name");

		WaitForPageLoad();

		ContentPagesNavigator.goToTranslation(pageName = "Test Content Page Name");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "ja-JP");

		Translations.translateFragmentField(
			experienceName = "Segment Email Experience",
			ff = "true",
			fieldName = "element-text",
			fragmentText = "経験をテストする");

		PortletEntry.publish();

		JSONLayout.deletePublicLayout(
			groupName = "Test Site Name",
			layoutName = "Test Content Page Name");

		Translations.openTranslationAdmin(siteURLKey = "test-site-name");

		Translations.viewEmptyState();
	}

	@description = "This test covers LPS-125966. This ensures that a warning message shows when viewing a translation that its web content has been deleted."
	@priority = "4"
	@refactordone
	test WarningAppearsForTranslationAfterWCIsDeleted {
		JSONWebcontent.addWebContent(
			content = "WC WebContent Content",
			groupName = "Guest",
			title = "WC WebContent Title");

		WebContentNavigator.openWebContentAdmin(siteURLKey = "guest");

		Translations.gotoTranslate(webContentTitle = "WC WebContent Title");

		Translations.changeTargetLocale(
			currentTargetLocale = "ar-SA",
			newTargetLocale = "es-ES");

		Translations.viewBaseFields(
			webContentContent = "WC WebContent Content",
			webContentTitle = "WC WebContent Title");

		Translations.translateFields(
			webContentContent = "WC WebContent Contenido",
			webContentDescription = "WC WebContent Descripción",
			webContentTitle = "WC WebContent Título");

		PortletEntry.publish();

		JSONWebcontent.moveWebContentToTrash(
			groupName = "Guest",
			title = "WC WebContent Title");

		Translations.openTranslationAdmin(siteURLKey = "guest");

		AssertConsoleTextNotPresent(value1 = "com.liferay.journal.exception.NoSuchArticleException");

		Translations.viewTranslationEntry(
			language = "es-ES",
			status = "Approved",
			title = "Translation of Translation to es-ES");

		AssertClick(
			key_rowEntry = "Translation of Translation to es-ES",
			locator1 = "ContentRow#ENTRY_CONTENT_ENTRY_NAME_LINK",
			value1 = "Translation of Translation to es-ES");

		AssertTextEquals(
			locator1 = "Message#INFO",
			value1 = "Info:You do not have permissions to translate to any of the available languages.");

		RecycleBin.openRecycleBinAdmin(siteURLKey = "guest");

		RecycleBin.deleteCP(
			assetName = "WC WebContent Title",
			assetType = "Web Content Article");

		Translations.openTranslationAdmin(siteURLKey = "guest");

		Translations.viewEmptyState();
	}

}