@component-name = "portal-user-management-and-portal-configuration"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Language Override";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		ApplicationsMenu.gotoPortlet(
			category = "Configuration",
			panel = "Control Panel",
			portlet = "Language Override");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
	}

	@description = "This test adds a new language key via the Language Override portlet and asserts that a user can search and view it in the main view page."
	@priority = "5"
	test CanAddLanguageKey {
		task ("Given that a user is in the Language Override portlet") {
			ControlMenu.viewHeaderTitle(headerTitle = "Language Override");
		}

		task ("When a user clicks on the plus button, fills out the form, and saves it") {
			LanguageOverride.addLanguageKey(
				languageKey = "text-contains-error",
				translationOverrideList = "en-US,fr-FR,pt-BR,es-ES",
				translationOverrideValueList = "Text contains error,Le texte contient une erreur,O texto contÃƒÂ©m erro,El texto contiene error");
		}

		task ("Then the language key is successfully saved and can be viewed in the View page") {
			Search.searchCP(searchTerm = "text-contains-error");

			AssertTextEquals(
				key_languageKey = "text-contains-error",
				locator1 = "LanguageOverride#VIEW_PAGE_LANGUAGE_KEY",
				value1 = "text-contains-error");

			AssertTextEquals(
				key_translation = "Text contains error",
				locator1 = "LanguageOverride#VIEW_PAGE_LANGUAGE_KEY_TRANSLATION",
				value1 = "Text contains error");
		}
	}

	@description = "This test asserts that a user can remove all translation overrides on the main view page for language keys that are overridden and doing so will delete the language key"
	@priority = "5"
	test CanRemoveAllTranslationOverridesViaMenuItem {
		task ("Given that a user has created a new language key") {
			LanguageOverride.addLanguageKey(
				languageKey = "text-contains-error",
				translationOverrideList = "en-US,fr-FR,pt-BR,es-ES",
				translationOverrideValueList = "Text contains error,Le texte contient une erreur,O texto contÃƒÂ©m erro,El texto contiene error");
		}

		task ("and the user sets the navigation filter to Override") {
			ManagementBar.setFilterAndOrder(filterBy = "Override");
		}

		task ("When the user removes all translation overrides via the Menu Item option") {
			LanguageOverride.removeAllTranslationOverrides(languageKey = "text-contains-error");
		}

		task ("Then all the translations will be removed and thus deleting the Overridden key") {
			LanguageOverride.openLanguageOverridePortlet();

			Search.searchCP(searchTerm = "text-contains-error");

			AssertTextEquals(
				locator1 = "Message#EMPTY_INFO",
				value1 = "No language entries were found");
		}
	}

	@description = "This test asserts that a user can remove translation override for a selected language for language keys that are overridden via the menu item"
	@priority = "3"
	test CanRemoveTranslationOverrideForSelectedLanguageViaMenuItem {
		task ("Given that a user has created a new language key") {
			LanguageOverride.addLanguageKey(
				languageKey = "text-contains-error",
				translationOverrideList = "en-US,fr-FR,pt-BR,es-ES",
				translationOverrideValueList = "Text contains error,Le texte contient une erreur,O texto contÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©m erro,El texto contiene error");
		}

		task ("and the user sets the navigation filter to Override") {
			ManagementBar.setFilterAndOrder(filterBy = "Override");
		}

		task ("When the user selects a language and removes translation override for the selected language") {
			LanguageOverride.removeTranslationOverrideForSelectedLanguage(
				currentLanguage = "en-US",
				languageKey = "text-contains-error",
				newLanguage = "pt-BR");
		}

		task ("Then only the selected translation override will be removed") {
			LanguageOverride.openLanguageOverridePortlet();

			Search.searchCP(searchTerm = "text-contains-error");

			LanguageOverride.goToLanguageKey(languageKey = "text-contains-error");

			AssertTextEquals(
				key_fieldLabel = "pt-BR",
				locator1 = "TextInput#GENERIC_TEXT_INPUT",
				value1 = "");
		}
	}

}