@component-name = "portal-analytics-cloud"
definition {

	property analytics.cloud.enabled = "true";
	property custom.properties = "jsonws.web.service.paths.excludes=";
	property minimum.slave.ram = "24";
	property portal.release = "false";
	property portal.upstream = "true";
	property slave.label = "slave-1";
	property testray.main.component.name = "Analytics Cloud";

	setUp {
		task ("Copy the token from AC") {
			ACUtils.launchAC();

			ACSettings.takeTokenFromAnalyticsCloud();
		}

		task ("Set up instance and sign in DXP") {
			TestCase.setUpPortalInstance();

			ACUtils.launchDXP();
		}

		task ("Add a new site with a public widget page") {
			ACUtils.addSiteAndPage();
		}

		task ("Add a new user") {
			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");
		}

		task ("Connect the DXP to AC") {
			ACDXPSettings.connectDXPtoAnalyticsCloud(siteName = "Site Name");
		}
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		ACUtils.tearDownDXP();

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}

		else {
			JSONGroup.deleteGroupByName(groupName = "Site Name");

			JSONUser.tearDownNonAdminUsers();
		}

		ACUtils.tearDownAC();
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8483 | Test Summary: Add members from different pages"
	@priority = "3"
	test CanAddMembersFromDifferentPages {
		task ("Add 5 more new users") {
			for (var n : list "1,2,3,4,5") {
				JSONUser.addUser(
					userEmailAddress = "user${n}@liferay.com",
					userFirstName = "user${n}",
					userLastName = "user${n}",
					userScreenName = "user${n}");

				JSONUser.setFirstPassword(
					agreeToTermsAndAnswerReminderQuery = "true",
					requireReset = "false",
					userEmailAddress = "user${n}@liferay.com");
			}
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "userea,user1,user2,user3,user4,user5") {
				if ("${username}" == "userea") {
					var fullName = "userfn userln";
				}

				else {
					var fullName = "${username} ${username}";
				}

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new static segment") {
			ACNavigation.goToSegments();

			ACSegments.createStaticSegment();
		}

		task ("Type the segment name") {
			ACSegments.nameSegment(segmentName = "Static Segment Test");
		}

		task ("Select the 5 items in Add Members modal") {
			Click(locator1 = "ACSegments#ADD_MEMBERS_BUTTON");

			ACUtils.changePagination(itemsPerPage = "5");
		}

		task ("Add the user1 user1 as member") {
			Click(
				key_TableMember = "user1 user1",
				locator1 = "ACSegments#TABLE_CHECKBOX");

			Click(locator1 = "ACSegments#ADD_BUTTON");
		}

		task ("Select the 5 items in Add Members modal") {
			Click(locator1 = "ACSegments#ADD_MEMBERS_BUTTON");

			ACUtils.changePagination(itemsPerPage = "5");
		}

		task ("Navigate to page 2") {
			ACUtils.checkAnyPage(pageNumber = "2");
		}

		task ("Add the userfn userln as member") {
			Click(
				key_TableMember = "userfn userln",
				locator1 = "ACSegments#TABLE_CHECKBOX");

			Click(locator1 = "ACSegments#ADD_BUTTON");
		}

		task ("Create the segment") {
			ACSegments.saveSegment();
		}

		task ("View members of segment") {
			ACNavigation.switchTab(tabName = "Membership");

			for (var username : list "user1 user1,userfn userln") {
				AssertVisible(
					key_userName = "${username}",
					locator1 = "ACSegments#SEGMENT_MEMBERS");
			}
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8476 | Test Summary: Cancel Creating a Dynamic Segment"
	@priority = "3"
	test CanCancelCreatingDynamicSegment {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Sign in as new user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");
		}

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add an email field") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "email");

			ACSegments.editTextCriterion(textInput = "userea@liferay.com");
		}

		task ("Cancel the creation") {
			ACSegments.cancelSegment();

			Button.click(button = "Leave Page");
		}

		task ("View the empty info in Segments admin") {
			AssertTextPresent(
				locator1 = "//body",
				value1 = "No Segments Created");

			AssertVisible(locator1 = "ACSegments#CREATE_SEGMENT_BUTTON");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8477 | Test Summary: Cancel creating a static segment"
	@priority = "3"
	test CanCancelCreatingStaticSegment {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Sign in as new user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");
		}

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new static segment") {
			ACNavigation.goToSegments();

			ACSegments.createStaticSegment();

			ACSegments.nameSegment(segmentName = "Static Segment Test");
		}

		task ("Add the new user as member") {
			ACSegments.addStaticMember(tableMember = "userfn userln");
		}

		task ("Cancel the creation") {
			ACSegments.cancelSegment();

			Button.click(button = "Leave Page");
		}

		task ("View the empty info in Segments admin") {
			AssertTextPresent(
				locator1 = "//body",
				value1 = "No Segments Created");

			AssertVisible(locator1 = "ACSegments#CREATE_SEGMENT_BUTTON");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8478 | Test Summary: Create a Dynamic Individuals Segment By Date"
	@priority = "4"
	test CanCreateDynamicIndividualsSegmentByDate {
		task ("Add one more user with a given birth date") {
			JSONUser.addUser(
				birthdayDay = "10",
				birthdayMonth = "10",
				birthdayYear = "2020",
				userEmailAddress = "user1@liferay.com",
				userFirstName = "user1",
				userLastName = "user1",
				userScreenName = "user1");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "user1@liferay.com");
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "userea,user1") {
				if ("${username}" == "userea") {
					var fullName = "userfn userln";
				}

				else {
					var fullName = "${username} ${username}";
				}

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add a birthDate field") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "birthDate");

			ACSegments.selectOperator(operator = "is after");

			ACSegments.editDateCriterion(
				day = "14",
				month = "September",
				year = "2016");
		}

		task ("Create the segment") {
			ACSegments.saveSegment();
		}

		task ("Navigate to Segments admin") {
			ACNavigation.goToSegments();
		}

		task ("Search the new segment") {
			ACUtils.searchBar(searchItem = "Dynamic Segment Test");

			ACAssets.viewAssets(assetName = "Dynamic Segment Test");
		}

		task ("View the number of Membership is 1") {
			ACAssets.viewAssetsInfo(
				assetName = "Dynamic Segment Test",
				index = "1",
				value = "1");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8481 | Test Summary: Create a Dynamic Individuals Segment with a criteria that uses a boolean and a does not contain"
	@priority = "4"
	test CanCreateDynamicSegmentWithIndividualCriteriaUsesBooleanAndDoesNotContain {
		task ("Add three more new users") {
			for (var n : list "1,2,3") {
				JSONUser.addUser(
					userEmailAddress = "user${n}@liferay.com",
					userFirstName = "user${n}",
					userLastName = "user${n}",
					userScreenName = "user${n}");

				JSONUser.setFirstPassword(
					agreeToTermsAndAnswerReminderQuery = "true",
					requireReset = "false",
					userEmailAddress = "user${n}@liferay.com");
			}
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "user1,user2,user3") {
				var fullName = "${username} ${username}";

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a CSV Data Source") {
			ACSettings.addCSVDataSource(
				dataSourceName = "CSV Gender",
				sourceFileName = "contacts_doNotCall.csv");
		}

		task ("Exit Settings") {
			ACNavigation.exitSettings();
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add a jobTitle criteria from Individual Attributes") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "jobTitle");

			ACSegments.selectOperator(operator = "does not contain");

			ACSegments.editTextCriterion(textInput = "Doctor");
		}

		task ("Add a male criteria from Individual Attributes") {
			ACSegments.addSegmentField(segmentField = "doNotCall");

			ACSegments.editWebBehaviorCriterion(
				activitiesOption = "False",
				indexField = "2");
		}

		task ("Create the segment") {
			ACSegments.saveSegment();
		}

		task ("Navigate to Segments admin") {
			ACNavigation.goToSegments();
		}

		task ("Search the new segment") {
			ACUtils.searchBar(searchItem = "Dynamic Segment Test");

			ACAssets.viewAssets(assetName = "Dynamic Segment Test");
		}

		task ("View the number of Membership is 1") {
			ACAssets.viewAssetsInfo(
				assetName = "Dynamic Segment Test",
				index = "1",
				value = "1");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8480 | Test Summary: Create a Dynamic Individuals Segment with a criteria that uses is known and is not"
	@priority = "4"
	test CanCreateDynamicSegmentWithIndividualCriteriaUsesIsKnownAndIsNot {
		task ("Add three more new users") {
			for (var n : list "1,2,3") {
				JSONUser.addUser(
					userEmailAddress = "user${n}@liferay.com",
					userFirstName = "user${n}",
					userLastName = "user${n}",
					userScreenName = "user${n}");

				JSONUser.setFirstPassword(
					agreeToTermsAndAnswerReminderQuery = "true",
					requireReset = "false",
					userEmailAddress = "user${n}@liferay.com");
			}
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "user1,user2,user3") {
				var fullName = "${username} ${username}";

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a CSV Data Source") {
			ACSettings.addCSVDataSource(
				dataSourceName = "CSV Country",
				sourceFileName = "contacts_country.csv");
		}

		task ("Exit Settings") {
			ACNavigation.exitSettings();
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add the first country criteria from Individual Attributes") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "country");

			ACSegments.selectOperator(operator = "is not");

			ACSegments.editTextCriterion(textInput = "USA");
		}

		task ("Add the second country criteria from Individual Attributes") {
			ACSegments.addSegmentField(segmentField = "country");

			ACSegments.editWebBehaviorCriterion(
				activitiesOption = "is known",
				indexField = "2");
		}

		task ("Create the segment") {
			ACSegments.saveSegment();
		}

		task ("Navigate to Segments admin") {
			ACNavigation.goToSegments();
		}

		task ("Search the new segment") {
			ACUtils.searchBar(searchItem = "Dynamic Segment Test");

			ACAssets.viewAssets(assetName = "Dynamic Segment Test");
		}

		task ("View the number of Membership is 2") {
			ACAssets.viewAssetsInfo(
				assetName = "Dynamic Segment Test",
				index = "1",
				value = "2");
		}
	}

	@description = "Create a dynamic segment with individuals"
	@priority = "5"
	test CanCreateDynamicSegmentWithIndividuals {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Sign in as new user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");
		}

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		ACUtils.launchAC();

		ACProperties.switchProperty(propertyName = "${propertyName}");

		ACNavigation.goToSegments();

		ACSegments.createDynamicSegment();

		ACSegments.nameSegment(segmentName = "Dynamic Segment Test");

		ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

		ACSegments.addSegmentField(segmentField = "email");

		ACSegments.editTextCriterion(textInput = "userea@liferay.com");

		ACSegments.saveSegment();

		ACNavigation.goToSegments();

		ACSegments.accessSegment(segmentName = "Dynamic Segment Test");

		ACNavigation.switchTab(tabName = "Membership");

		AssertTextEquals(
			locator1 = "ACSegments#SEGMENT_LABEL",
			value1 = "DYNAMIC SEGMENT");

		AssertElementPresent(
			key_userName = "userfn userln",
			locator1 = "ACSegments#SEGMENT_MEMBERS");
	}

	@description = "Create a Dynamic Individuals Segment with a criteria that uses is unknown"
	@priority = "5"
	test CanCreateDynamicSegmentWithIndividualsUseUnknown {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Sign in as new user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");
		}

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		ACUtils.launchAC();

		ACProperties.switchProperty(propertyName = "${propertyName}");

		ACNavigation.goToSegments();

		ACSegments.createDynamicSegment();

		ACSegments.nameSegment(segmentName = "Dynamic Segment Test");

		ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

		ACSegments.addSegmentField(segmentField = "fullName");

		ACSegments.editFormControlCriterion(
			criterionName = "fullName",
			option = "is unknown");

		ACSegments.saveSegment();

		ACNavigation.goToSegments();

		ACSegments.accessSegment(segmentName = "Dynamic Segment Test");

		ACNavigation.switchTab(tabName = "Membership");

		AssertTextEquals(
			locator1 = "ACSegments#SEGMENT_LABEL",
			value1 = "DYNAMIC SEGMENT");

		AssertElementPresent(
			key_userName = "userfn userln",
			locator1 = "ACSegments#SEGMENT_MEMBERS");
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8482 | Test Summary: Create a nested criteria"
	@priority = "3"
	test CanCreateNestedCriteria {
		task ("Add one more user with a given birth date") {
			JSONUser.addUser(
				birthdayDay = "10",
				birthdayMonth = "10",
				birthdayYear = "2020",
				userEmailAddress = "user1@liferay.com",
				userFirstName = "user1",
				userLastName = "user1",
				userScreenName = "user1");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "user1@liferay.com");
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "userea,user1,test") {
				if ("${username}" == "userea") {
					var fullName = "userfn userln";
				}

				else if ("${username}" == "test") {
					var fullName = "Test Test";
				}

				else {
					var fullName = "${username} ${username}";
				}

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add an email criteria from Individual Attributes") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "email");

			ACSegments.selectOperator(operator = "contains");

			ACSegments.editTextCriterion(textInput = "@liferay.com");
		}

		task ("Add a birthDate criteria from Individual Attributes") {
			ACSegments.addSegmentField(segmentField = "birthDate");

			ACSegments.selectOperator(
				index = "2",
				operator = "is after");

			ACSegments.editDateCriterion(
				day = "10",
				month = "September",
				year = "2000");
		}

		task ("Add a userName criteria from Individual Attributes nested in email") {
			ACSegments.addNestedSegmentField(
				index = "2",
				segmentField = "userName");

			ACSegments.selectOperator(
				index = "3",
				operator = "does not contain");

			ACSegments.editTextCriterion(
				index = "3",
				textInput = "@liferay.com");
		}

		task ("View the first conjunction") {
			ACSegments.viewConjunction(conjunction = "And");
		}

		task ("Change the second conjunction to OR") {
			ACSegments.editConjunction(index = "2");

			ACSegments.viewConjunction(
				conjunction = "Or",
				index = "2");
		}

		task ("Save the segment") {
			ACSegments.saveSegment();
		}

		task ("Navigate to Segments admin") {
			ACNavigation.goToSegments();
		}

		task ("Search the new segment") {
			ACUtils.searchBar(searchItem = "Dynamic Segment Test");

			ACAssets.viewAssets(assetName = "Dynamic Segment Test");
		}

		task ("View the number of Membership is 2") {
			ACAssets.viewAssetsInfo(
				assetName = "Dynamic Segment Test",
				index = "1",
				value = "2");
		}
	}

	@description = "Create a segment that contains anonymous individuals"
	@priority = "5"
	test CanCreateSegmentWithAnonymousIndividuals {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		JSONUser.addUser(
			userEmailAddress = "liferay@liferay.com",
			userFirstName = "liferay",
			userLastName = "liferay",
			userScreenName = "liferay");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "liferay@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "liferay@liferay.com",
			userLoginFullName = "liferay liferay");

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		ACUtils.launchAC();

		ACProperties.switchProperty(propertyName = "${propertyName}");

		ACNavigation.goToSegments();

		ACSegments.createDynamicSegment();

		ACSegments.nameSegment(segmentName = "Dynamic Segment Test");

		ACSegments.includeAnonymous();

		ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

		ACSegments.addSegmentField(segmentField = "fullName");

		ACSegments.editFormControlCriterion(
			criterionName = "fullName",
			option = "is unknown");

		ACSegments.saveSegment();

		ACNavigation.goToSegments();

		ACSegments.accessSegment(segmentName = "Dynamic Segment Test");

		ACSegments.viewSegmentMembershipLegendNumbers(
			anonymousNumber = "1",
			knownNumber = "1",
			totalNumber = "2");

		ACSegments.viewIncludeAnonymousLabel();
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8479 | Test Summary: Create a Segment with a Number Property"
	@priority = "4"
	test CanCreateSegmentWithNumberProperty {
		task ("Add three more new users") {
			for (var n : list "1,2,3") {
				JSONUser.addUser(
					userEmailAddress = "user${n}@liferay.com",
					userFirstName = "user${n}",
					userLastName = "user${n}",
					userScreenName = "user${n}");

				JSONUser.setFirstPassword(
					agreeToTermsAndAnswerReminderQuery = "true",
					requireReset = "false",
					userEmailAddress = "user${n}@liferay.com");
			}
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "user1,user2,user3") {
				var fullName = "${username} ${username}";

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a CSV Data Source") {
			ACSettings.addCSVDataSource(
				dataSourceName = "CSV Age",
				fieldName = "age",
				fieldType = "Number",
				newField = "true",
				selectAnalyticsCloudField = "true",
				sourceFileName = "contacts_age.csv");
		}

		task ("Exit Settings") {
			ACNavigation.exitSettings();
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add an age criteria from Individual Attributes") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "age");

			ACSegments.selectOperator(operator = "less than");

			ACSegments.editNumberCriterion(numberInput = "40");
		}

		task ("Create the segment") {
			ACSegments.saveSegment();
		}

		task ("Navigate to Segments admin") {
			ACNavigation.goToSegments();
		}

		task ("Search the new segment") {
			ACUtils.searchBar(searchItem = "Dynamic Segment Test");

			ACAssets.viewAssets(assetName = "Dynamic Segment Test");
		}

		task ("View the number of Membership is 2") {
			ACAssets.viewAssetsInfo(
				assetName = "Dynamic Segment Test",
				index = "1",
				value = "2");
		}
	}

	@description = "Create a static segment with individual"
	@priority = "5"
	test CanCreateStaticSegmentWithIndividuals {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Sign in as new user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");
		}

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		ACUtils.launchAC();

		ACProperties.switchProperty(propertyName = "${propertyName}");

		ACNavigation.goToSegments();

		ACSegments.createStaticSegment();

		ACSegments.nameSegment(segmentName = "Static Segment Test");

		ACSegments.addStaticMember(tableMember = "userfn userln");

		ACSegments.saveSegment();

		ACNavigation.goToSegments();

		ACSegments.accessSegment(segmentName = "Static Segment Test");

		ACNavigation.switchTab(tabName = "Membership");

		AssertTextEquals(
			locator1 = "ACSegments#SEGMENT_LABEL",
			value1 = "STATIC SEGMENT");

		AssertElementPresent(
			key_userName = "userfn userln",
			locator1 = "ACSegments#SEGMENT_MEMBERS");
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8474 | Test Summary: Duplicate a criteria"
	@priority = "3"
	test CanDuplicateCriteria {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add a jobTitle field") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "jobTitle");
		}

		task ("Duplicate the criteria") {
			ACSegments.duplicateSegmentCriteria(criteriaName = "jobTitle");
		}

		task ("View the both criterias") {
			ACSegments.viewDuplicatedCriteria(
				criteriaName = "jobTitle",
				totalCriteriaCount = "2");
		}

		task ("Define the first criteria") {
			ACSegments.selectOperator(operator = "contains");

			ACSegments.editTextCriterion(textInput = "web developer");
		}

		task ("Define the second criteria") {
			ACSegments.selectOperator(
				index = "2",
				operator = "contains");

			ACSegments.editTextCriterion(
				index = "2",
				textInput = "lawyer");
		}

		task ("Save the segment") {
			ACSegments.saveSegment();
		}

		task ("View both criterias in Segment Criteria card") {
			ACSegments.viewSegmentCriteriaIndividualAttributes(
				attributeName = "jobTitle",
				attributeValue = '''"web developer"''',
				condition = "contains",
				conjunction = "AND");

			ACSegments.viewSegmentCriteriaIndividualAttributes(
				attributeName = "jobTitle",
				attributeValue = '''"lawyer"''',
				condition = "contains",
				index = "2");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8471 | Test Summary: Paginate Segment Profile in Membership List"
	@priority = "3"
	test CanPaginateSegmentProfileInMembershipList {
		task ("Add 5 more new users") {
			for (var n : list "1,2,3,4,5") {
				JSONUser.addUser(
					userEmailAddress = "user${n}@liferay.com",
					userFirstName = "user${n}",
					userLastName = "user${n}",
					userScreenName = "user${n}");

				JSONUser.setFirstPassword(
					agreeToTermsAndAnswerReminderQuery = "true",
					requireReset = "false",
					userEmailAddress = "user${n}@liferay.com");
			}
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "userea,user1,user2,user3,user4,user5") {
				if ("${username}" == "userea") {
					var fullName = "userfn userln";
				}

				else {
					var fullName = "${username} ${username}";
				}

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add an email field") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "email");

			ACSegments.selectOperator(operator = "contains");

			ACSegments.editTextCriterion(textInput = "@liferay.com");

			ACSegments.saveSegment();
		}

		task ("Navigate to Membership tab") {
			ACNavigation.switchTab(tabName = "Membership");
		}

		task ("Select the 5 Items in Pagination") {
			ACUtils.changePagination(itemsPerPage = "5");
		}

		task ("View only 5 users are shown in page 1") {
			for (var username : list "userfn userln,user1 user1,user2 user2,user3 user3,user4 user4") {
				ACAssets.viewAssets(assetName = "${username}");
			}

			AssertElementNotPresent(
				key_assetName = "user5 user5",
				locator1 = "ACAssets#ASSETS_TABLE");
		}

		task ("Navigate to the page 2") {
			ACUtils.checkAnyPage(pageNumber = "2");
		}

		task ("View the user5 user5 is shown in page 2") {
			ACAssets.viewAssets(assetName = "user5 user5");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8472 | Test Summary: Paginate static segment 'Add Members' creation model"
	@priority = "3"
	test CanPaginateStaticSegmentAddMembers {
		task ("Add 5 more new users") {
			for (var n : list "1,2,3,4,5") {
				JSONUser.addUser(
					userEmailAddress = "user${n}@liferay.com",
					userFirstName = "user${n}",
					userLastName = "user${n}",
					userScreenName = "user${n}");

				JSONUser.setFirstPassword(
					agreeToTermsAndAnswerReminderQuery = "true",
					requireReset = "false",
					userEmailAddress = "user${n}@liferay.com");
			}
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "userea,user1,user2,user3,user4,user5") {
				if ("${username}" == "userea") {
					var fullName = "userfn userln";
				}

				else {
					var fullName = "${username} ${username}";
				}

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new static segment") {
			ACNavigation.goToSegments();

			ACSegments.createStaticSegment();
		}

		task ("View the Pagination is 10 items in Add Members modal") {
			Click(locator1 = "ACSegments#ADD_MEMBERS_BUTTON");

			ACUtils.viewPaginationItemsPerPage(itemsPerPage = "10");
		}

		task ("View all users are shown in current page") {
			for (var username : list "user1 user1,user2 user2,user3 user3,user4 user4,user5 user5,userfn userln") {
				AssertVisible(
					key_TableMember = "${username}",
					locator1 = "ACSegments#TABLE_CHECKBOX");
			}
		}

		task ("Select the 5 items in Add Members modal") {
			ACUtils.changePagination(itemsPerPage = "5");
		}

		task ("View only 5 users are shown in current page") {
			for (var username : list "user1 user1,user2 user2,user3 user3,user4 user4,user5 user5") {
				AssertVisible(
					key_TableMember = "${username}",
					locator1 = "ACSegments#TABLE_CHECKBOX");
			}

			AssertElementNotPresent(
				key_TableMember = "userfn userln",
				locator1 = "ACSegments#TABLE_CHECKBOX");
		}

		task ("Navigate to the page 2") {
			ACUtils.checkAnyPage(pageNumber = "2");
		}

		task ("View the userfn userln is shown in modal") {
			AssertVisible(
				key_TableMember = "userfn userln",
				locator1 = "ACSegments#TABLE_CHECKBOX");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8475 | Test Summary: Dynamic segment members preview in real time"
	@priority = "3"
	test CanPreviewDynamicSegmentMembers {
		task ("Add one more user with a jobTitle") {
			JSONUser.addUser(
				jobTitle = "lawyer",
				userEmailAddress = "user1@liferay.com",
				userFirstName = "user1",
				userLastName = "user1",
				userScreenName = "user1");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "user1@liferay.com");
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "userea,user1") {
				if ("${username}" == "userea") {
					var fullName = "userfn userln";
				}

				else {
					var fullName = "${username} ${username}";
				}

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new dynamic segment") {
			ACNavigation.goToSegments();

			ACSegments.createDynamicSegment();

			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("Add an email criteria") {
			ACSegments.goToSidebarAttributes(criterion = "Individual Attributes");

			ACSegments.addSegmentField(segmentField = "email");

			ACSegments.selectOperator(operator = "contains");

			ACSegments.editTextCriterion(textInput = "@liferay.com");
		}

		task ("View two users are shown on the Preview mode") {
			ACSegments.previewSegmentMembership();

			for (var username : list "userfn userln,user1 user1") {
				ACAssets.viewAssets(assetName = "${username}");
			}

			Click.mouseDownMouseUp(locator1 = "Modal#CLOSE_BUTTON");
		}

		task ("Add a jobTitle criteria") {
			ACSegments.addSegmentField(segmentField = "jobTitle");

			ACSegments.editTextCriterion(
				index = "2",
				textInput = "lawyer");
		}

		task ("View only one user is shown on Preview mode") {
			ACSegments.previewSegmentMembership();

			ACAssets.viewAssets(assetName = "user1 user1");

			AssertElementNotPresent(
				key_assetName = "userfn userln",
				locator1 = "ACAssets#ASSETS_TABLE");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8473 | Test Summary: Filter the Segment 'Add Members' Modal"
	@priority = "3"
	test CanSearchUserInAddMembersModal {
		task ("Add one more user with a given birth date") {
			JSONUser.addUser(
				userEmailAddress = "user1@liferay.com",
				userFirstName = "user1",
				userLastName = "user1",
				userScreenName = "user1");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "user1@liferay.com");
		}

		task ("Sync the Contact Data") {
			ACDXPSettings.syncNewContactData();
		}

		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("View the page as different users") {
			for (var username : list "userea,user1") {
				if ("${username}" == "userea") {
					var fullName = "userfn userln";
				}

				else {
					var fullName = "${username} ${username}";
				}

				User.logoutAndLoginPG(
					userLoginEmailAddress = "${username}@liferay.com",
					userLoginFullName = "${fullName}");

				Navigator.gotoSitePage(
					pageName = "AC Page",
					siteName = "Site Name");
			}
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new static segment") {
			ACNavigation.goToSegments();

			ACSegments.createStaticSegment();
		}

		task ("Search username in Add Members modal") {
			Click(locator1 = "ACSegments#ADD_MEMBERS_BUTTON");

			ACUtils.searchBar(searchItem = "userfn userln");
		}

		task ("View only the userea shown in modal") {
			AssertVisible(
				key_assetName = "userfn userln",
				locator1 = "ACAssets#ASSETS_TABLE");

			AssertElementNotPresent(
				key_assetName = "user1 user1",
				locator1 = "ACAssets#ASSETS_TABLE");
		}

		task ("Search email in Add Members modal") {
			ACUtils.clearSearchBar();

			ACUtils.searchBar(searchItem = "user1@liferay.com");
		}

		task ("View only the user1 shown in modal") {
			AssertVisible(
				key_assetName = "user1 user1",
				locator1 = "ACAssets#ASSETS_TABLE");

			AssertElementNotPresent(
				key_assetName = "userfn userln",
				locator1 = "ACAssets#ASSETS_TABLE");
		}
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8133 | Test Summary: Create button shows option to create static or dynamic"
	@priority = "5"
	test CanSeeOptionsToCreateStaticOrDynamicSegment {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Sign in as new user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");
		}

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		ACUtils.launchAC();

		ACProperties.switchProperty(propertyName = "${propertyName}");

		ACNavigation.goToSegments();

		Click(locator1 = "ACSegments#CREATE_SEGMENT_BUTTON");

		for (var segmentType : list "Dynamic Segment,Static Segment") {
			getFirst = StringUtil.extractFirst("${segmentType}"," ");

			getFirst = StringUtil.upperCase("${getFirst}");

			AssertTextEquals(
				key_SegmentType = "${getFirst}",
				locator1 = "ACSegments#SELECT_SEGMENT_TYPE",
				value1 = "${segmentType}");
		}

		ACSegments.selectSegmentType(segmentType = "STATIC");

		AssertTextEquals(
			locator1 = "ACSegments#SEGMENT_LABEL",
			value1 = "STATIC SEGMENT");

		ACNavigation.goToSegments();

		ACSegments.createDynamicSegment();

		AssertTextEquals(
			locator1 = "ACSegments#SEGMENT_LABEL",
			value1 = "DYNAMIC SEGMENT");
	}

	@description = "Feature ID: Legacy | Automation ID: LRAC-8484 | Test Summary: Segment Form Validation"
	@priority = "5"
	test ViewSegmentFormValidation {
		task ("Get site assigned property name") {
			var propertyName = ACDXPSettings.getAssignedPropertyName(siteName = "Site Name");
		}

		task ("Sign in as new user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");
		}

		task ("View the site page") {
			Navigator.gotoSitePage(
				pageName = "AC Page",
				siteName = "Site Name");
		}

		task ("Switch to new property in AC") {
			ACUtils.launchAC();

			ACProperties.switchProperty(propertyName = "${propertyName}");
		}

		task ("Add a new static segment") {
			ACNavigation.goToSegments();

			ACSegments.createStaticSegment();
		}

		task ("View the Create button is disabled when the Name field is empty") {
			AssertVisible(
				key_text = "Create",
				locator1 = "Button#ANY_DISABLED");
		}

		task ("Type the segment name") {
			ACSegments.nameSegment(segmentName = "Static Segment Test");
		}

		task ("View the Create button is still disabled when there are no individuals") {
			AssertTextEquals(
				locator1 = "ACSegments#NO_MEMBER_TITLE",
				value1 = "There are no Individuals found.");

			AssertVisible(
				key_text = "Create",
				locator1 = "Button#ANY_DISABLED");
		}

		task ("Cancel the creation") {
			ACSegments.cancelSegment();

			AssertTextPresent(
				locator1 = "//body",
				value1 = "No Segments Created");
		}

		task ("Add a new dynamic segment") {
			ACSegments.createDynamicSegment();
		}

		task ("View the Save Segment button is disabled when the Name field is empty") {
			AssertVisible(
				key_text = "Save Segment",
				locator1 = "Button#ANY_DISABLED");
		}

		task ("Type the segment name") {
			ACSegments.nameSegment(segmentName = "Dynamic Segment Test");
		}

		task ("View the Save Segment button is still disabled when the form is empty") {
			ACSegments.viewDeletedCriteria();

			AssertTextPresent(
				locator1 = "//body",
				value1 = "Drag and drop over an existing criteria to form groups.");

			AssertVisible(
				key_text = "Save Segment",
				locator1 = "Button#ANY_DISABLED");
		}
	}

}